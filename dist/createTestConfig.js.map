{"version":3,"sources":["../src/createTestConfig.js"],"names":[],"mappings":";;;;;;;;kBAmCwB,gB;;AAnCxB;;;;AAEA;;;;AACA;;;;;;AAEA,IAAM,8IAMkC,QAAQ,MAAR,CAAe,OAAf,IAA0B,EAN5D,+gBAAN;;AA8Be,SAAS,gBAAT,CAA0B,YAA1B,EAAwC;AAAA,MAC9C,GAD8C,GACG,YADH,CAC9C,GAD8C;AAAA,MACzC,IADyC,GACG,YADH,CACzC,IADyC;AAAA,MACnC,KADmC,GACG,YADH,CACnC,KADmC;AAAA,MACnB,kBADmB,GACG,YADH,CAC5B,OAD4B;;;AAGrD,MAAI,gBAAgB,kCAAmB,YAAnB,CAApB;;AAEA,gBAAc,OAAd,CAAsB,IAAtB,CACE,IAAI,kBAAQ,YAAZ,CACE,MADF,EAEE,EAAC,KAAK,IAAN,EAAY,WAAW,IAAvB,EAFF,CADF;;;AAQA,+BAEK,aAFL;;AAIE,YAAQ,MAJV;AAKE,aAAS,mBALX;;AAOE,aAAS,GAPX;;AASE,WAAO;AACL,aAAO;AADF,KATT;;AAaE,YAAQ;AACN,YAAM,IADA;AAEN,gBAAU;AAFJ;;AAbV;;;AAqBA,kBAAgB,qBAAM,aAAN,EAAqB,kBAArB,CAAhB;;AAEA,SAAO,aAAP;AACD","file":"createTestConfig.js","sourcesContent":["import webpack from 'webpack';\n\nimport merge from './util/merge';\nimport createCommonConfig from './util/createCommonConfig';\n\nconst runner = `\n\n(function() {\n\n  const fs = require('fs');\n  const Mocha = require('mocha');\n  Mocha.reporters.Base.window.width = ${process.stdout.columns || 80};\n  Mocha.reporters.Base.symbols.dot = '.';\n\n  const _mocha = new Mocha({});\n  _mocha.ui('bdd');\n  _mocha.reporter('spec');\n  _mocha.useColors(true);\n  _mocha.suite.emit('pre-require', global, '', _mocha);\n\n  setTimeout(function() {\n    _mocha.run(failures => {\n      process.send(\n        JSON.stringify({\n          coverage: global.__coverage__ //FIXME: this is a hack for tradie-plugin-coverage\n        }),\n        () => process.exit(failures ? 1 : 0)\n      );\n    });\n  }, 1);\n\n})();\n\n`;\n\nexport default function createTestConfig(tradieConfig) {\n  const {src, dest, files, webpack: extraWebpackConfig} = tradieConfig;\n\n  let webpackConfig = createCommonConfig(tradieConfig);\n\n  webpackConfig.plugins.push(\n    new webpack.BannerPlugin(\n      runner,\n      {raw: true, entryOnly: true}\n    )\n  );\n\n  //merge common and test config\n  webpackConfig = {\n\n    ...webpackConfig,\n\n    target: 'node',\n    devtool: 'inline-source-map',\n\n    context: src,\n\n    entry: {\n      tests: files\n    },\n\n    output: {\n      path: dest,\n      filename: '[name].js'\n    }\n\n  };\n\n  //merge extra webpack config\n  webpackConfig = merge(webpackConfig, extraWebpackConfig);\n\n  return webpackConfig;\n}\n"]}